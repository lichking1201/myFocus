/**
 * Created with JetBrains WebStorm.
 * User: lichen
 * Date: 13-11-19
 * Time: 下午3:30
 */

/**
 * 仿http://fashion.sina.com.cn/s/2013-10-28/220326550.shtml?qq-pf-to=pcqq.c2c 焦点图
 * @DOM
 *      <div id="focus">
 *          <img src="" title="">
 *          <img src="" title="">
 *          <img src="" title="">
 *      </div>
 * @CSS
 *      <link rel="stylesheet" type="text/css" href="focus.css" media="all" />
 * @Usage
 *      $("#focus").OYD_Focus(options);
 * @options
 *      beginSlider: 0,                    //初始图片
 *      focusHead: "",                     //焦点图标题
 *      counterNav: true,                  //进度与图片说明栏开启
 *      controlNav: "thumb",               //缩略图索引开启
 *      thumbCount: 6,                     //缩略图数量
 *      autoPlay: true                     //自动播放开启
 *      pauseTime:4000                     //默认自动播放间隔
 *↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ 未实现
 *      thumbNum: true,                    //显示缩略图角标数字
 */

(function(a){a.fn.OYD_Focus=function(b){var c=a.extend({},a.fn.OYD_Focus.defaults,b);return this.each(function(){var d={totalSlides:0,currentImg:"",currentSlider:0,imgItem:[]};var e=a(this);e.addClass("focusSlider");var f=e.width(),g=a('<span class="focus-slider"></span>');var h=e.children();h.each(function(){var v=a(this),w="";if(!v.is("img")){if(v.is("a")){w=v.attr("href");v=v.find("img:first")};v=v.find("img:first")};v.wrap(g);var x=a(".focus-slider");x.width(f);var y={img:v,imgSrc:v.attr("src"),imgTitle:v.attr("title"),slider:B};d.imgItem.push(y);d.totalSlides++;x.remove()});if(d.totalSlides<c.thumbCount){c.thumbCount=d.totalSlides};var i=a('<div class="focus-slider-all"></div>');e.append(i);var j=e.find(".focus-slider-all");d.currentSlider=c.beginSlider;a(d.imgItem[d.currentSlider].slider).appendTo(j);var k=a('<div class="focus-head"><h3>'+c.focusHead+'</h3></div>');if(c.focusHead!=""){e.before(k)};var l=a('<div class="focus-info"><div class="focus-counter"><span class="current-counter">'+(d.currentSlider+1)+'</span>/<span class="total-counter">'+d.totalSlides+'</<span></div><p class="focus-title">'+d.imgItem[d.currentSlider].imgTitle+'</p></span></div> ');if(c.counterNav){e.after(l);var v=e.next(".focus-info");a(".focus-title").width(Math.ceil((f-110)/16)+"em")};var m=a('<div class="focus-control"></div>'),n=a('<a id="focus-thumbsLeft"></a><div class="focus-thumb"></div><div class="focus-bar"></div><a id="focus-thumbsRight"></a>');if(c.controlNav!=""){e.parent().append(m);var v=e.siblings(".focus-control");if(c.controlNav=="thumb"){v.append(n);var w=v.children(".focus-thumb"),x=c.thumbCount,y=v.children(".focus-bar");var z="";for(var A=0;A<d.totalSlides;A++){z+='<li><img src="'+d.imgItem[A].imgSrc+'" alt=""/><b></b></li>'};w.append(a('<ul>'+z+'</ul>'));var B=w.find("li"),C=w.find("ul"),D=f-40,E=D/x-10;w.width(D).height(E*0.75+10);B.width(E).height(E*0.75).eq(0).addClass("focus-active");v.find("a").css("top",(E*0.75+10-34)/2);var F;v.find("#focus-thumbsLeft").on("mousedown",function(){var G=a(this);F=setInterval(function(){G.pixMove("left",C)},10)});v.find("#focus-thumbsLeft").on("mouseup",function(){var G=a(this);clearInterval(F)});v.find("#focus-thumbsRight").on("mousedown",function(){var G=a(this);F=setInterval(function(){G.pixMove("right",C)},10)});v.find("#focus-thumbsRight").on("mouseup",function(){var G=a(this);clearInterval(F)});B.each(function(){var G=a(this),H=G.find("img"),I=new Image();I.src=H.attr("src");if(I.width*0.75>I.height){H.width(E).css("padding-top",(E*0.75-H.height())/2)}else{H.height(0.75*E)}});B.on("click",function(){var G=a(this),H=d.currentSlider,I=G.index(),J;G.addClass("focus-active").siblings("li").removeClass("focus-active");J=I-H;q(J);d.currentSlider=I})}};var o,p;if(c.autoPlay){p=setInterval(q,c.pauseTime)};e.on({mousemove:function(v){var w=a(this).offset().left;o=v.pageX-w;if(o<f/2){a(this).css("cursor","url('http://i3.sinaimg.cn/dy/deco/2012/1218/hdfigure/hd_left_arrow.cur') ,pointer")}else{a(this).css("cursor","url('http://i3.sinaimg.cn/dy/deco/2012/1218/hdfigure/hd_right_arrow.cur') ,pointer")}},mouseover:function(){clearInterval(p)},mouseleave:function(){p=setInterval(q,c.pauseTime)},click:function(){q()}});controlBlk.on({mouseover:function(){clearInterval(p)},mouseleave:function(){p=setInterval(q,c.pauseTime)}});function q(v){if(v==0){return}else if(v>0){s(v)}else if(v<0){t(-v)}else{if(o<f/2){if(d.currentSlider==0){s(d.totalSlides-1)}else{t(1)}}else{if(d.currentSlider==d.totalSlides-1){t(d.totalSlides-1)}else{s(1)}}};thumb.eq(d.currentSlider).addClass("focus-active").siblings("li").removeClass("focus-active");var w=thumb.eq(d.currentSlider).position().left,x=Math.ceil(c.thumbCount/ 2),              //选中项固定位置：居中 y=w/ thumb.outerWidth(true);          //选中项位置 if(d.totalSlides>c.thumbCount){if(y<=d.totalSlides-x){if(y<x){thumbUl.animate({left:0})}else{thumbUl.animate({left:-w+(x-1)*thumb.outerWidth(true)+"px"})}}else{thumbUl.animate({left:-(d.totalSlides-c.thumbCount)*thumb.outerWidth(true)+"px"})}}};a.fn.pixMove=function(v,w){var x=w.children(),y=x.outerWidth(true),z=x.size(),A=y*z,B=parseInt(w.css("left"));w.css({position:"absolute",left:B}).parent().css("position","relative");if(v=="right"){if(B>w.parent().width()-A){B-=10;w.css({left:B+"px"})}else{w.css({left:w.parent().width()-A})}}else if(v=="left"){if(B<0){B+=10;w.css({left:B+"px"})}else{w.css({left:0})}}};function r(v){return a(d.imgItem[v].slider)};function s(v){var w=r(d.currentSlider),x=r(d.currentSlider+v);d.currentSlider+=v;if(d.currentSlider>=d.totalSlides){x=r(0);d.currentSlider=0};w.after(x);x.animate({left:-f},function(){a(this).css("left",0)});w.animate({left:-f},function(){a(this).css("left",0).remove()});e.height(x.height());a(".focus-title").html(d.imgItem[d.currentSlider].imgTitle);counter.find(".current-counter").text(d.currentSlider+1)};function t(v){var w=r(d.currentSlider),x=r(d.currentSlider-v);d.currentSlider-=v;if(d.currentSlider<0){x=r(d.totalSlides-1);d.currentSlider=d.totalSlides-1};w.after(x);x.css("left",-f*2).animate({left:-f},function(){a(this).css("left",0)});w.animate({left:f},function(){a(this).css("left",0).remove()});e.height(x.height());a(".focus-title").text(d.imgItem[d.currentSlider].imgTitle);counter.find(".current-counter").text(d.currentSlider+1)};function u(v,w,x,y){}})};a.fn.OYD_Focus.defaults={beginSlider:0,focusHead:"",counterNav:true,controlNav:"thumb",thumbCount:5,thumbNum:true,autoPlay:true,pauseTime:4000}})(jQuery);